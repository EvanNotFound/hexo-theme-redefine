import{getStyleStatus as e,updateStyleStatus as t}from"./state/styleStatus.js";let o=null,n=!1;const handleScroll=()=>{o&&(o.updateScrollStyle(),o.updateAutoHideTools())},handleHomeBannerBlur=()=>{o&&o.updateHomeBannerBlur()},registerScrollHandlers=e=>{!n&&e&&(n=!0,window.addEventListener("scroll",handleScroll,{signal:e}),window.addEventListener("scroll",((e,t)=>{let o;return(...n)=>{clearTimeout(o),o=setTimeout(()=>e(...n),t)}})(handleHomeBannerBlur,20),{signal:e}))};export const initUtilsGlobals=({signal:e}={})=>{registerScrollHandlers(e)};export const initUtilsPage=({signal:n}={})=>{const i={html_root_dom:document.querySelector("html"),pageContainer_dom:document.querySelector(".page-container"),pageTop_dom:document.querySelector(".main-content-header"),homeBanner_dom:document.querySelector(".home-banner-container"),homeBannerBackground_dom:document.querySelector(".home-banner-background"),scrollProgressBar_dom:document.querySelector(".scroll-progress-bar"),pjaxProgressBar_dom:document.querySelector(".pjax-progress-bar"),backToTopButton_dom:document.querySelector(".tool-scroll-to-top"),toolsList:document.querySelector(".hidden-tools-list"),toggleButton:document.querySelector(".toggle-tools-list"),innerHeight:window.innerHeight,pjaxProgressBarTimer:null,prevScrollValue:0,fontSizeLevel:0,triggerViewHeight:.5*window.innerHeight,isHasScrollProgressBar:!0===theme.global.scroll_progress.bar,isHasScrollPercent:!0===theme.global.scroll_progress.percentage,updateScrollStyle(){const e=window.pageYOffset||document.documentElement.scrollTop,t=document.documentElement.scrollHeight,o=window.innerHeight||document.documentElement.clientHeight,n=this.calculatePercentage(e,t,o);this.updateScrollProgressBar(n),this.updateScrollPercent(n),this.updatePageTopVisibility(e,o),this.prevScrollValue=e},updateScrollProgressBar(e){if(this.isHasScrollProgressBar&&this.scrollProgressBar_dom){const t=e.toFixed(3),o=0===e?"hidden":"visible";this.scrollProgressBar_dom.style.visibility=o,this.scrollProgressBar_dom.style.width=`${t}%`}},updateScrollPercent(e){if(this.isHasScrollPercent&&this.backToTopButton_dom){const t=this.backToTopButton_dom.querySelector(".percent");if(!t)return;const o=0!==e&&void 0!==e;this.backToTopButton_dom.classList.toggle("show",o),t.innerHTML=e.toFixed(0)}},updatePageTopVisibility(e,t){if(this.pageTop_dom)if(theme.navbar.auto_hide){const o=this.prevScrollValue,n=o>t&&e>o;this.pageTop_dom.classList.toggle("hide",n)}else this.pageTop_dom.classList.remove("hide")},calculatePercentage(e,t,o){let n=Math.round(e/(t-o)*100);return isNaN(n)||n<0||!isFinite(n)?n=0:n>100&&(n=100),n},updateHomeBannerBlur(){if(this.homeBannerBackground_dom&&"fixed"===theme.home_banner.style&&location.pathname===config.root){const e=(window.scrollY||window.pageYOffset)>=this.triggerViewHeight?15:0;try{requestAnimationFrame(()=>{this.homeBannerBackground_dom.style.filter=`blur(${e}px)`,this.homeBannerBackground_dom.style.webkitFilter=`blur(${e}px)`})}catch(e){console.error("Error updating banner blur:",e)}}},updateAutoHideTools(){const e=window.scrollY,t=document.body.scrollHeight,o=window.innerHeight,n=document.getElementsByClassName("right-side-tools-container"),i=document.getElementById("aplayer");for(let s=0;s<n.length;s++){const l=n[s];e<=100?location.pathname===config.root&&(l.classList.add("hide"),null!==i&&i.classList.add("hide")):e+o>=t-20?(l.classList.add("hide"),null!==i&&i.classList.add("hide")):(l.classList.remove("hide"),null!==i&&i.classList.remove("hide"))}},toggleToolsList(e){this.toolsList&&this.toggleButton&&(theme.global.side_tools&&theme.global.side_tools.auto_expand&&this.toolsList.classList.add("show"),e?this.toggleButton.addEventListener("click",()=>{this.toolsList.classList.toggle("show")},{signal:e}):this.toggleButton.addEventListener("click",()=>{this.toolsList.classList.toggle("show")}))},fontAdjPlus_dom:document.querySelector(".tool-font-adjust-plus"),fontAdMinus_dom:document.querySelector(".tool-font-adjust-minus"),globalFontSizeAdjust(o){const n=this.html_root_dom,i=this.fontAdjPlus_dom,s=this.fontAdMinus_dom;if(!n||!i||!s)return;const l=document.defaultView.getComputedStyle(document.body).fontSize,r=parseFloat(l);let a=0;const c=e();function setFontSize(e){const o=r*(1+.05*e);n.style.fontSize=`${o}px`,t({fontSizeLevel:e})}function increaseFontSize(){a=Math.min(a+1,5),setFontSize(a)}function decreaseFontSize(){a=Math.max(a-1,0),setFontSize(a)}c&&(a=c.fontSizeLevel,setFontSize(a)),o?(i.addEventListener("click",increaseFontSize,{signal:o}),s.addEventListener("click",decreaseFontSize,{signal:o})):(i.addEventListener("click",increaseFontSize),s.addEventListener("click",decreaseFontSize))},goComment(e){const t=document.querySelector(".go-comment");if(!t)return;const handler=()=>{const e=document.querySelector("#comment-anchor");if(e){const t=e.getBoundingClientRect().top+window.scrollY;window.scrollTo({top:t,behavior:"smooth"})}};e?t.addEventListener("click",handler,{signal:e}):t.addEventListener("click",handler)},getElementHeight(e){const t=document.querySelector(e);return t?t.getBoundingClientRect().height:0},inithomeBannerHeight(){this.homeBanner_dom&&(this.homeBanner_dom.style.height=this.innerHeight+"px")},initPageHeightHandle(){if(this.homeBanner_dom)return;const e=this.getElementHeight(".main-content-header")+this.getElementHeight(".main-content-body")+this.getElementHeight(".main-content-footer"),t=window.innerHeight,o=document.querySelector(".main-content-footer");if(o&&e<t){const n=Math.floor(t-e);n>0&&(o.style.marginTop=n-2+"px")}},setHowLongAgoLanguage:(e,t)=>t.replace(/%s/g,e),getHowLongAgo(e){const t=lang_ago,o=Math.floor(e/2592e3/12),n=Math.floor(e/2592e3),i=Math.floor(e/86400/7),s=Math.floor(e/86400),l=Math.floor(e/3600%24),r=Math.floor(e/60%60),a=Math.floor(e%60);return o>0?this.setHowLongAgoLanguage(o,t.year):n>0?this.setHowLongAgoLanguage(n,t.month):i>0?this.setHowLongAgoLanguage(i,t.week):s>0?this.setHowLongAgoLanguage(s,t.day):l>0?this.setHowLongAgoLanguage(l,t.hour):r>0?this.setHowLongAgoLanguage(r,t.minute):a>0?this.setHowLongAgoLanguage(a,t.second):void 0},relativeTimeInHome(){const e=document.querySelectorAll(".home-article-meta-info .home-article-date"),t=theme.home.article_date_format;"relative"===t?e&&e.forEach(e=>{const t=Date.now(),o=new Date(e.dataset.date.split(" GMT")[0]).getTime();e.innerHTML=this.getHowLongAgo(Math.floor((t-o)/1e3))}):"auto"===t&&e&&e.forEach(e=>{const t=Date.now(),o=new Date(e.dataset.date.split(" GMT")[0]).getTime();Math.floor((t-o)/864e5)<7&&(e.innerHTML=this.getHowLongAgo(Math.floor((t-o)/1e3)))})}};o=i,i.updateAutoHideTools(),i.toggleToolsList(n),i.globalFontSizeAdjust(n),i.goComment(n),i.initPageHeightHandle(),i.inithomeBannerHeight(),i.relativeTimeInHome()};
//# sourceMappingURL=utils.js.map