const e={isBigImage:!1,scale:1,isMouseDown:!1,dragged:!1,currentImgIndex:0,lastMouseX:0,lastMouseY:0,translateX:0,translateY:0,maskDom:null,targetImg:null},t=".markdown-body img, .masonry-item img, #shuoshuo-content img";let n=[],a=!1;const applyTransform=()=>{e.targetImg&&(e.targetImg.style.transform=`translate(${e.translateX}px, ${e.translateY}px) scale(${e.scale})`)},showHandle=t=>{e.maskDom&&(document.body.style.overflow=t?"hidden":"auto",e.maskDom.classList.toggle("active",t))},closeViewer=()=>{e.isBigImage&&(e.isBigImage=!1,showHandle(!1),e.scale=1,e.translateX=0,e.translateY=0,applyTransform())},handleArrowKeys=t=>{if(!e.isBigImage)return;if("Escape"===t.key)return void closeViewer();if("ArrowUp"===t.key||"ArrowLeft"===t.key)e.currentImgIndex=(e.currentImgIndex-1+n.length)%n.length;else{if("ArrowDown"!==t.key&&"ArrowRight"!==t.key)return;e.currentImgIndex=(e.currentImgIndex+1)%n.length}const a=n[e.currentImgIndex];if(!a||!e.targetImg)return;let s=a.src;a.hasAttribute("lazyload")&&(s=a.getAttribute("data-src"),a.src=s,a.removeAttribute("lazyload")),e.targetImg.src=s},updateImageNodes=()=>{n=Array.from(document.querySelectorAll(t))};export default function initImageViewer({signal:s,appSignal:r}={}){const i=document.querySelector(".image-viewer-container");if(!i)return void console.warn("Image viewer container not found. Exiting imageViewer function.");const o=i.querySelector("img");if(!o)return void console.warn("Target image not found in image viewer container. Exiting imageViewer function.");e.maskDom=i,e.targetImg=o,e.dragged=!1,updateImageNodes(),(e=>{a||(a=!0,e?document.addEventListener("keydown",handleArrowKeys,{signal:e}):document.addEventListener("keydown",handleArrowKeys))})(r);const zoomHandle=t=>{if(t.preventDefault(),!e.targetImg)return;const n=e.targetImg.getBoundingClientRect(),a=t.clientX-n.left,s=t.clientY-n.top,r=a-n.width/2,i=s-n.height/2,o=e.scale;e.scale+=-.001*t.deltaY,e.scale=Math.min(Math.max(.8,e.scale),4),o<e.scale?(e.translateX-=r*(e.scale-o),e.translateY-=i*(e.scale-o)):(e.translateX=0,e.translateY=0),applyTransform()},dragStartHandle=t=>{t.preventDefault(),e.isMouseDown=!0,e.lastMouseX=t.clientX,e.lastMouseY=t.clientY,e.targetImg.style.cursor="grabbing"};let l=0;const dragHandle=t=>{if(!e.isMouseDown)return;const n=(new Date).getTime();if(n-l<100)return;l=n;const a=t.clientX-e.lastMouseX,s=t.clientY-e.lastMouseY;e.translateX+=a,e.translateY+=s,e.lastMouseX=t.clientX,e.lastMouseY=t.clientY,applyTransform(),e.dragged=!0},dragEndHandle=t=>{e.isMouseDown&&t.stopPropagation(),e.isMouseDown=!1,e.targetImg.style.cursor="grab"},handleImageClick=a=>{const s=a.target.closest(t);if(!s||s.closest(".image-viewer-container"))return;updateImageNodes();const r=n.indexOf(s);e.currentImgIndex=-1===r?0:r,e.isBigImage=!0,showHandle(!0);let i=s.src;s.hasAttribute("lazyload")&&(i=s.getAttribute("data-src"),s.src=i,s.removeAttribute("lazyload")),e.targetImg.src=i},handleMaskClick=()=>{e.dragged||closeViewer(),e.dragged=!1};s?(o.addEventListener("wheel",zoomHandle,{passive:!1,signal:s}),o.addEventListener("mousedown",dragStartHandle,{passive:!1,signal:s}),o.addEventListener("mousemove",dragHandle,{passive:!1,signal:s}),o.addEventListener("mouseup",dragEndHandle,{passive:!1,signal:s}),o.addEventListener("mouseleave",dragEndHandle,{passive:!1,signal:s}),i.addEventListener("click",handleMaskClick,{signal:s}),document.addEventListener("click",handleImageClick,{signal:s})):(o.addEventListener("wheel",zoomHandle,{passive:!1}),o.addEventListener("mousedown",dragStartHandle,{passive:!1}),o.addEventListener("mousemove",dragHandle,{passive:!1}),o.addEventListener("mouseup",dragEndHandle,{passive:!1}),o.addEventListener("mouseleave",dragEndHandle,{passive:!1}),i.addEventListener("click",handleMaskClick),document.addEventListener("click",handleImageClick))}
//# sourceMappingURL=imageViewer.js.map